+++
title = "Amazon EFS ファイルシステムの作成"
weight = 20
+++

マネジメントコンソール上部の **「サービス」** から **<a href="https://console.aws.amazon.com/efs/home?region=us-west-2" target="_blank">Amazon Elastic File System (EFS)</a>** のページを開き、**「ファイルシステムの作成」** ボタンをクリックします。

![create-efs](/ecs/create-efs.ja.png)

 **「ステップ 1: ネットワークアクセスを設定する」** では、VPC に本ハンズオンの事前準備で作成した VPC（例：TargetVPC）を選択、マウントターゲットの**サブネット**にアベイラビリティゾーンごとの**プライベートサブネット**（\*-private-\*-web）、**セキュリテイグループ**に前頁で作成した **EFS 用のセキュリティグループ** (EFS-SG) を指定し、**「次のステップ」** をクリックします。

**「ステップ 2: ファイルシステムの設定を行う」** では、ライフサイクルポリシーの有効化や、スループットモードの変更、暗号化の有効化を行うことができます。本ハンズオンでは、**暗号化を有効化**し、他のオプションはデフォルト値のままにしておきます。

![efs-enc](/ecs/efs-enc.ja.png)

**「ステップ 3: クライアントアクセスを設定」** では、何も変更せずに **「次のステップ」** をクリックします。

![efs-review](/ecs/efs-review.ja.png)

**「ステップ 4: 確認と作成」** で、設定を確認し、**「ファイルシステムの作成」** をクリックします。

後続の [Amazon ECS タスク定義の作成]({{< ref "/create-task-definition.ja.md" >}})で必要になるため、
作成したファイルシステムの **DNS 名**を、テキストエディタ等にコピーしておいて下さい。

![efs-details](/ecs/efs-details.ja.png)

**「Amazon EC2 のマウント手順（ローカル VPC から）」** をクリックすると、作成した EFS ファイルシステムを EC2 インスタンスにマウントする手順が表示されます。今回のハンズオンでは、ファイルシステムを Web サーバーのインスタンスに一時的にマウントし、Wordpress のソースコンテンツを EFS ファイルシステムにコピーします。

### Web サーバーへのファイルシステムのマウント

**「ファイルシステムへのアクセス」** 配下にある、**「Amazon EC2 のマウント手順（ローカル VPC から）」** をクリックし、表示される手順に従って設定を行います。

1. Web サーバーの EC2 インスタンス（Webserver）にログインします。

   {{% notice tip %}}
Web サーバーへのログイン手順については、**「2. サーバーの移行」** で実施した[**アプリケーションの設定**]({{< ref "/server-migration/CE-Webserver-config.ja.md" >}}) を参照してください。
{{% /notice %}}

2. 以下のコマンドを実行して、Ubuntu インスタンス用の NFS クライアントをインストールします：
   ```
   sudo apt-get install nfs-common
   ```

3. マネジメントコンソールに表示されているコマンドを実行して、ファイルシステムをマウントします（以下例）。
   ![efs-mount](/ecs/efs-mount.ja.png)

ファイルシステムのマウントが完了したら、Web サーバーから **/var/www/html/wp-content** 配下にあるすべてのコンテンツを、マウントしたファイルシステムにコピーします（以下コマンド例）：
```
sudo cp -r /var/www/html/wp-content/* efs/
```
